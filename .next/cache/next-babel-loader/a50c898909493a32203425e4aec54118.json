{"ast":null,"code":"var _jsxFileName = \"/home/huy/apps/ecom-ui/components/User/signup.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, Fragment } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { gql } from \"@apollo/client\";\nimport { useMutation } from \"@apollo/client\";\nimport { onSignIn, init as reloadApollo } from \"../../apollo/action\";\nimport { getErrorMessage } from \"../../lib/chip\";\nimport { useApollo } from \"../../apollo/client\";\nimport { SignInMutation } from \"./signin\";\nimport { compose } from \"redux\";\nconst SignUpMutation = gql`\n  mutation($email: String!, $password: String!) {\n    createUser(data: { email: $email, password: $password }) {\n      id\n      email\n    }\n  }\n`;\nexport function SignUp() {\n  const [signUp] = useMutation(SignUpMutation);\n  const [signIn] = useMutation(SignInMutation);\n  const {\n    0: errorMsg,\n    1: setErrorMsg\n  } = useState();\n  const router = useRouter();\n  const client = useApollo();\n  const {\n    0: email,\n    1: setEmail\n  } = useState();\n  const {\n    0: password,\n    1: setPassword\n  } = useState();\n\n  async function letSignIn({\n    email,\n    password\n  }) {\n    try {\n      const {\n        data: dataSignIn\n      } = await signIn({\n        variables: {\n          email: email,\n          password: password\n        }\n      }); // if success\n\n      if (dataSignIn.authenticateUserWithPassword) {\n        const {\n          authenticateUserWithPassword: {\n            token,\n            item\n          }\n        } = dataSignIn;\n        localStorage.setItem(\"token\", token);\n        onSignIn({\n          user: item\n        });\n        await router.push({\n          pathname: \"/\"\n        });\n        await client.resetStore();\n        reloadApollo();\n      }\n    } catch (error) {\n      setErrorMsg(getErrorMessage(error));\n    }\n  } //if (email && password) letSignIn();\n\n\n  async function handleSubmit(event) {\n    var _event$currentTarget$, _event$currentTarget$2, _event$currentTarget$3;\n\n    event.preventDefault();\n    const email = (_event$currentTarget$ = event.currentTarget.elements.email) === null || _event$currentTarget$ === void 0 ? void 0 : _event$currentTarget$.value;\n    const password = (_event$currentTarget$2 = event.currentTarget.elements.password) === null || _event$currentTarget$2 === void 0 ? void 0 : _event$currentTarget$2.value;\n    const confirm = (_event$currentTarget$3 = event.currentTarget.elements.confirm) === null || _event$currentTarget$3 === void 0 ? void 0 : _event$currentTarget$3.value;\n    console.log(email, password, confirm); // pre check\n\n    if (!email) {\n      setErrorMsg(\"Vui lòng nhập tên tài khoản\");\n      return;\n    }\n\n    if (password !== confirm) {\n      setErrorMsg(\"Nhập khẩu nhập lại không khớp\");\n      return;\n    } // Sign up\n\n\n    try {\n      await client.clearStore();\n      const {\n        data\n      } = await signUp({\n        variables: {\n          email,\n          password\n        }\n      }); // if Success\n\n      if (data.createUser) {\n        // try login\n        letSignIn({\n          email,\n          password\n        });\n      }\n    } catch (error) {\n      setErrorMsg(getErrorMessage(error));\n    }\n  }\n\n  return __jsx(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 5\n    }\n  }, __jsx(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }, \"\\u0110\\u0103ng K\\xFD T\\xE0i Kho\\u1EA3n\"), __jsx(\"form\", {\n    noValidate: true,\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, __jsx(\"h5\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }\n  }, \"T\\xE0i kho\\u1EA3n\"), __jsx(\"input\", {\n    required: true,\n    label: \"T\\xE0i kho\\u1EA3n\",\n    name: \"email\",\n    placeholder: \"Nh\\u1EADp T\\xE0i kho\\u1EA3n\",\n    style: {\n      border: \"1px solid black\",\n      padding: 3,\n      paddingLeft: 13\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  }), __jsx(\"h5\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }, \"M\\u1EADt kh\\u1EA9u\"), __jsx(\"input\", {\n    required: true,\n    name: \"password\",\n    label: \"M\\u1EADt kh\\u1EA9u\",\n    placeholder: \"Nh\\u1EADp M\\u1EADt kh\\u1EA9u\",\n    type: \"password\",\n    style: {\n      border: \"1px solid black\",\n      padding: 3,\n      paddingLeft: 13\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }), __jsx(\"h5\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }\n  }, \"Nh\\u1EADp L\\u1EA1i M\\u1EADt Kh\\u1EA9u\"), __jsx(\"input\", {\n    required: true,\n    name: \"confirm\",\n    label: \"M\\u1EADt kh\\u1EA9u\",\n    placeholder: \"Nh\\u1EADp L\\u1EA1i M\\u1EADt Kh\\u1EA9u\",\n    type: \"password\",\n    style: {\n      border: \"1px solid black\",\n      padding: 3,\n      paddingLeft: 13\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }), __jsx(\"button\", {\n    type: \"submit\",\n    style: {\n      marginTop: 21\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }, \"\\u0110\\u0103ng K\\xFD\"), __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, errorMsg)));\n}","map":{"version":3,"sources":["/home/huy/apps/ecom-ui/components/User/signup.js"],"names":["useState","Fragment","useRouter","gql","useMutation","onSignIn","init","reloadApollo","getErrorMessage","useApollo","SignInMutation","compose","SignUpMutation","SignUp","signUp","signIn","errorMsg","setErrorMsg","router","client","email","setEmail","password","setPassword","letSignIn","data","dataSignIn","variables","authenticateUserWithPassword","token","item","localStorage","setItem","user","push","pathname","resetStore","error","handleSubmit","event","preventDefault","currentTarget","elements","value","confirm","console","log","clearStore","createUser","border","padding","paddingLeft","marginTop"],"mappings":"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","sourcesContent":["import { useState, Fragment } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { gql } from \"@apollo/client\";\nimport { useMutation } from \"@apollo/client\";\nimport { onSignIn, init as reloadApollo } from \"../../apollo/action\";\nimport { getErrorMessage } from \"../../lib/chip\";\nimport { useApollo } from \"../../apollo/client\";\nimport { SignInMutation } from \"./signin\";\nimport { compose } from \"redux\";\nconst SignUpMutation = gql`\n  mutation($email: String!, $password: String!) {\n    createUser(data: { email: $email, password: $password }) {\n      id\n      email\n    }\n  }\n`;\nexport function SignUp() {\n  const [signUp] = useMutation(SignUpMutation);\n  const [signIn] = useMutation(SignInMutation);\n  const [errorMsg, setErrorMsg] = useState();\n  const router = useRouter();\n  const client = useApollo();\n  const [email, setEmail] = useState();\n  const [password, setPassword] = useState();\n\n  async function letSignIn({ email, password }) {\n    try {\n      const { data: dataSignIn } = await signIn({\n        variables: {\n          email: email,\n          password: password,\n        },\n      });\n      // if success\n      if (dataSignIn.authenticateUserWithPassword) {\n        const {\n          authenticateUserWithPassword: { token, item },\n        } = dataSignIn;\n        localStorage.setItem(\"token\", token);\n        onSignIn({ user: item });\n        await router.push({ pathname: \"/\" });\n        await client.resetStore();\n        reloadApollo();\n      }\n    } catch (error) {\n      setErrorMsg(getErrorMessage(error));\n    }\n  }\n\n  //if (email && password) letSignIn();\n  async function handleSubmit(event) {\n    event.preventDefault();\n\n    const email = event.currentTarget.elements.email?.value;\n    const password = event.currentTarget.elements.password?.value;\n    const confirm = event.currentTarget.elements.confirm?.value;\n    console.log(email, password, confirm);\n    // pre check\n    if (!email) {\n      setErrorMsg(\"Vui lòng nhập tên tài khoản\");\n      return;\n    }\n    if (password !== confirm) {\n      setErrorMsg(\"Nhập khẩu nhập lại không khớp\");\n      return;\n    }\n    // Sign up\n    try {\n      await client.clearStore();\n      const { data } = await signUp({\n        variables: {\n          email,\n          password,\n        },\n      });\n      // if Success\n      if (data.createUser) {\n        // try login\n        letSignIn({ email, password });\n      }\n    } catch (error) {\n      setErrorMsg(getErrorMessage(error));\n    }\n  }\n  return (\n    <Fragment>\n      <h2>Đăng Ký Tài Khoản</h2>\n      <form noValidate onSubmit={handleSubmit}>\n        <h5>Tài khoản</h5>\n        <input\n          required\n          label=\"Tài khoản\"\n          name=\"email\"\n          placeholder=\"Nhập Tài khoản\"\n          style={{ border: \"1px solid black\", padding: 3, paddingLeft: 13 }}\n        />\n        <h5>Mật khẩu</h5>\n        <input\n          required\n          name=\"password\"\n          label=\"Mật khẩu\"\n          placeholder=\"Nhập Mật khẩu\"\n          type=\"password\"\n          style={{ border: \"1px solid black\", padding: 3, paddingLeft: 13 }}\n        />\n        <h5>Nhập Lại Mật Khẩu</h5>\n\n        <input\n          required\n          name=\"confirm\"\n          label=\"Mật khẩu\"\n          placeholder=\"Nhập Lại Mật Khẩu\"\n          type=\"password\"\n          style={{ border: \"1px solid black\", padding: 3, paddingLeft: 13 }}\n        />\n\n        <button\n          type=\"submit\"\n          style={{\n            marginTop: 21,\n          }}\n        >\n          Đăng Ký\n        </button>\n        <p>{errorMsg}</p>\n      </form>\n    </Fragment>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}