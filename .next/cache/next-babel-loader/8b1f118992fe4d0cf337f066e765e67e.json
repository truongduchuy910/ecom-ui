{"ast":null,"code":"var _jsxFileName = \"/home/huy/apps/ecom-ui/components/Cart/list.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { gql, useQuery, useMutation } from \"@apollo/client\";\nimport { emptyCart } from \"../../apollo/action\";\nimport { customerVar, newOrderVar, newOrderCountVar } from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\nimport { formatMoney } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    customer @client\n  }\n`; // create orderItem\n\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`; // create Order\n\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\n\nconst OrderItemsCreateInput = item => ({\n  data: {\n    product: {\n      connect: {\n        id: item.product.id\n      }\n    },\n    price: item.price,\n    quantity: item.quantity\n  }\n});\n\nconst OrderItemsCreateInputs = cartItems => cartItems.map(item => OrderItemsCreateInput(item));\n\nexport function List() {\n  var _dataCartItems$cartIt, _dataCartItems$cartIt2, _dataCartItems$cartIt3;\n\n  const {\n    data: dataCartItems,\n    loading,\n    error\n  } = useQuery(CART);\n  if (loading) return __jsx(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 23\n    }\n  });\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n  const router = useRouter();\n  const customer = dataCartItems === null || dataCartItems === void 0 ? void 0 : dataCartItems.customer;\n  console.log(customer);\n\n  const order = async e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const dataOICI = OrderItemsCreateInputs(dataCartItems === null || dataCartItems === void 0 ? void 0 : dataCartItems.cartItems);\n\n    if ((dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.length) && (customer === null || customer === void 0 ? void 0 : customer.id)) {\n      dataOICI.map(data => data.data.ofSeller = {\n        connect: {\n          id: page.seller.id\n        }\n      });\n      const {\n        data: dataCreateOrderItems,\n        error\n      } = await createOrderItems({\n        variables: {\n          data: dataOICI\n        }\n      });\n\n      if (dataCreateOrderItems.createOrderItems) {\n        let variables = {\n          items: dataCreateOrderItems.createOrderItems.map(e => ({\n            id: e.id\n          })),\n          customer: {\n            id: customer.id\n          },\n          ofSeller: {\n            id: page.seller.id\n          },\n          total: sum\n        };\n\n        try {\n          const {\n            data: dataCreateOrder,\n            errors: ER\n          } = await createOrder({\n            variables\n          });\n          newOrderVar(true);\n          newOrderCountVar(true);\n          emptyCart();\n          router.push({\n            pathname: \"/order\"\n          });\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    }\n  };\n\n  let sum = 0;\n  dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt = dataCartItems.cartItems) === null || _dataCartItems$cartIt === void 0 ? void 0 : _dataCartItems$cartIt.map(cartItem => {\n    sum += cartItem.price;\n  });\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, __jsx(\"h5\", {\n    style: css.h5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }, \"T\\u1ED5ng\"), __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }\n  }, formatMoney(sum)), __jsx(\"button\", {\n    style: _objectSpread(_objectSpread({}, css.button), {}, {\n      marginBottom: theme.spacing(4)\n    }),\n    onClick: order,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, \"\\u0110\\u1EB7t H\\xE0ng\"), dataCartItems ? (dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt2 = dataCartItems.cartItems) === null || _dataCartItems$cartIt2 === void 0 ? void 0 : _dataCartItems$cartIt2.length) === 0 ? __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, \"B\\u1EA1n ch\\u01B0a ch\\u1ECDn s\\u1EA3n ph\\u1EA9m n\\xE0o!\") : dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt3 = dataCartItems.cartItems) === null || _dataCartItems$cartIt3 === void 0 ? void 0 : _dataCartItems$cartIt3.map(cartItem => {\n    return __jsx(CartItem, {\n      key: cartItem.product.id,\n      cartItem: cartItem,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 20\n      }\n    });\n  }) : null);\n}","map":{"version":3,"sources":["/home/huy/apps/ecom-ui/components/Cart/list.js"],"names":["gql","useQuery","useMutation","emptyCart","customerVar","newOrderVar","newOrderCountVar","Item","CartItem","useRouter","page","formatMoney","Fragment","css","theme","CART","CREATE_ORDER_ITEMS","CREATE_ORDER","OrderItemsCreateInput","item","data","product","connect","id","price","quantity","OrderItemsCreateInputs","cartItems","map","List","dataCartItems","loading","error","createOrderItems","createOrder","router","customer","console","log","order","e","preventDefault","stopPropagation","dataOICI","length","ofSeller","seller","dataCreateOrderItems","variables","items","total","sum","dataCreateOrder","errors","ER","push","pathname","cartItem","h5","button","marginBottom","spacing"],"mappings":"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","sourcesContent":["import { gql, useQuery, useMutation } from \"@apollo/client\";\n\nimport { emptyCart } from \"../../apollo/action\";\nimport {\n  customerVar,\n  newOrderVar,\n  newOrderCountVar,\n} from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\n\nimport { formatMoney } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    customer @client\n  }\n`;\n// create orderItem\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`;\n\n// create Order\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nconst OrderItemsCreateInput = (item) => ({\n  data: {\n    product: { connect: { id: item.product.id } },\n    price: item.price,\n    quantity: item.quantity,\n  },\n});\nconst OrderItemsCreateInputs = (cartItems) =>\n  cartItems.map((item) => OrderItemsCreateInput(item));\n\nexport function List() {\n  const { data: dataCartItems, loading, error } = useQuery(CART);\n  if (loading) return <Loading />;\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n  const router = useRouter();\n  const customer = dataCartItems?.customer;\n  console.log(customer);\n  const order = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const dataOICI = OrderItemsCreateInputs(dataCartItems?.cartItems);\n\n    if (dataOICI?.length && customer?.id) {\n      dataOICI.map(\n        (data) => (data.data.ofSeller = { connect: { id: page.seller.id } })\n      );\n      const { data: dataCreateOrderItems, error } = await createOrderItems({\n        variables: {\n          data: dataOICI,\n        },\n      });\n\n      if (dataCreateOrderItems.createOrderItems) {\n        let variables = {\n          items: dataCreateOrderItems.createOrderItems.map((e) => ({\n            id: e.id,\n          })),\n          customer: { id: customer.id },\n          ofSeller: { id: page.seller.id },\n          total: sum,\n        };\n        try {\n          const { data: dataCreateOrder, errors: ER } = await createOrder({\n            variables,\n          });\n          newOrderVar(true);\n          newOrderCountVar(true);\n          emptyCart();\n          router.push({ pathname: \"/order\" });\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    }\n  };\n\n  let sum = 0;\n  dataCartItems?.cartItems?.map((cartItem) => {\n    sum += cartItem.price;\n  });\n  return (\n    <div>\n      <h5 style={css.h5}>Tổng</h5>\n      <p>{formatMoney(sum)}</p>\n      <button\n        style={{ ...css.button, marginBottom: theme.spacing(4) }}\n        onClick={order}\n      >\n        Đặt Hàng\n      </button>\n      {dataCartItems ? (\n        dataCartItems?.cartItems?.length === 0 ? (\n          <p>Bạn chưa chọn sản phẩm nào!</p>\n        ) : (\n          dataCartItems?.cartItems?.map((cartItem) => {\n            return <CartItem key={cartItem.product.id} cartItem={cartItem} />;\n          })\n        )\n      ) : null}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}