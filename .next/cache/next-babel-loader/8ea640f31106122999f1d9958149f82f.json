{"ast":null,"code":"var _jsxFileName = \"/media/huy/New Volume/linux/apps/ecom-ui/components/Cart/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { gql, useQuery, useMutation } from \"@apollo/client\";\nimport { emptyCart } from \"../../apollo/action\";\nimport { customerVar, newOrderVar, newOrderCountVar } from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment, useContext } from \"react\";\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nimport { QuickCart } from \"./quickCart\";\nimport { Row, Col } from \"reactstrap\";\nimport { SellerContext } from \"../src/SellerProvider\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    user @client\n    customer @client\n  }\n`; // create orderItem\n\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`; // create Order\n\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nexport const OrderItemsCreateInput = item => ({\n  data: {\n    product: {\n      connect: {\n        id: item.product.id\n      }\n    },\n    price: item.price,\n    quantity: item.quantity\n  }\n});\nexport const OrderItemsCreateInputs = (cartItems = []) => cartItems === null || cartItems === void 0 ? void 0 : cartItems.map(item => OrderItemsCreateInput(item));\nexport const order = async ({\n  createOrderItems,\n  createOrder,\n  dataOICI,\n  theme,\n  customer,\n  sum,\n  router\n}) => {\n  // create cart items\n  const {\n    data: dataCOI,\n    error\n  } = await createOrderItems({\n    variables: {\n      data: dataOICI\n    }\n  });\n  console.log(dataCOI); // creat cart and connect cart items\n\n  if (dataCOI.createOrderItems) {\n    let variables = {\n      items: dataCOI.createOrderItems.map(e => ({\n        id: e.id\n      })),\n      customer: {\n        id: customer.id\n      },\n      ofSeller: {\n        id: theme.seller.id\n      },\n      total: sum\n    };\n\n    try {\n      var _dataCreateOrder$crea;\n\n      const {\n        data: dataCreateOrder,\n        errors: ER\n      } = await createOrder({\n        variables\n      });\n      console.log(dataCreateOrder);\n      newOrderVar(true);\n      newOrderCountVar(true);\n      emptyCart();\n      router.push({\n        pathname: \"/order\",\n        query: {\n          createOrderId: dataCreateOrder === null || dataCreateOrder === void 0 ? void 0 : (_dataCreateOrder$crea = dataCreateOrder.createOrder) === null || _dataCreateOrder$crea === void 0 ? void 0 : _dataCreateOrder$crea.id\n        }\n      });\n    } catch {}\n  }\n};\nexport function Cart() {\n  const theme = useContext(SellerContext);\n  const router = useRouter(); // query\n\n  const {\n    data: cartData,\n    loading,\n    error\n  } = useQuery(CART); // mutation\n\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n  if (loading || error || !cartData) return __jsx(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 45\n    }\n  });\n  const {\n    customer,\n    cartItems,\n    user\n  } = cartData;\n  let sum = 0;\n  cartItems === null || cartItems === void 0 ? void 0 : cartItems.map(cartItem => {\n    sum += cartItem.price;\n  }); // create OrderItemsCreateInputs (GraphQL type)\n\n  let dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.map(data => data.data.ofSeller = {\n    connect: {\n      id: theme.seller.id\n    }\n  }); // function\n\n  return __jsx(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 5\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }\n  }, (user === null || user === void 0 ? void 0 : user.id) ? __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 11\n    }\n  }, __jsx(Customer, {\n    customer: customer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }\n  })) : __jsx(\"div\", {\n    style: {\n      paddingBottom: theme.spacing(3)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 11\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: \"/signin\",\n      query: {\n        redirect: \"/cart\"\n      }\n    },\n    style: {\n      marginBottom: theme.spacing(4),\n      display: \"block\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  }, \"Mua h\\xE0ng v\\u1EDBi t\\xE0i kho\\u1EA3n (Khuy\\xEAn d\\xF9ng)\"), __jsx(QuickCart, {\n    cartItems: cartItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  })), \" \", __jsx(List, {\n    cartItems: cartItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  }), (dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.length) && user ? __jsx(\"button\", {\n    style: theme.css.button,\n    onClick: () => {\n      order({\n        createOrderItems,\n        createOrder,\n        dataOICI,\n        page,\n        customer,\n        sum,\n        router\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 11\n    }\n  }, \"X\\xE1c nh\\u1EADn \\u0111\\u01A1n h\\xE0ng\") : null));\n}","map":{"version":3,"sources":["/media/huy/New Volume/linux/apps/ecom-ui/components/Cart/index.js"],"names":["gql","useQuery","useMutation","emptyCart","customerVar","newOrderVar","newOrderCountVar","Item","CartItem","List","useRouter","page","formatMoney","getErrorMessage","Fragment","useContext","Loading","Link","Customer","QuickCart","Row","Col","SellerContext","CART","CREATE_ORDER_ITEMS","CREATE_ORDER","OrderItemsCreateInput","item","data","product","connect","id","price","quantity","OrderItemsCreateInputs","cartItems","map","order","createOrderItems","createOrder","dataOICI","theme","customer","sum","router","dataCOI","error","variables","console","log","items","e","ofSeller","seller","total","dataCreateOrder","errors","ER","push","pathname","query","createOrderId","Cart","cartData","loading","user","cartItem","paddingBottom","spacing","redirect","marginBottom","display","length","css","button"],"mappings":";;;AAAA,SAASA,GAAT,EAAcC,QAAd,EAAwBC,WAAxB,QAA2C,gBAA3C;AAEA,SAASC,SAAT,QAA0B,qBAA1B;AACA,SACEC,WADF,EAEEC,WAFF,EAGEC,gBAHF,QAIO,qBAJP;AAKA,SAASC,IAAI,IAAIC,QAAjB,QAAiC,QAAjC;AACA,SAASC,IAAT,QAAqB,QAArB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,IAAT,QAAqB,oBAArB;AAEA,SAASC,WAAT,EAAsBC,eAAtB,QAA6C,gBAA7C;AACA,SAASC,QAAT,EAAmBC,UAAnB,QAAqC,OAArC;AAEA,SAASC,OAAT,QAAwB,gBAAxB;AACA,SAASC,IAAT,QAAqB,aAArB;AACA,SAASR,IAAI,IAAIS,QAAjB,QAAiC,6BAAjC;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,GAAT,EAAcC,GAAd,QAAyB,YAAzB;AACA,SAASC,aAAT,QAA8B,uBAA9B;AACA,OAAO,MAAMC,IAAI,GAAGvB,GAAI;;;;;;CAAjB,C,CAOP;;AACA,OAAO,MAAMwB,kBAAkB,GAAGxB,GAAI;;;;;;CAA/B,C,CAQP;;AACA,OAAO,MAAMyB,YAAY,GAAGzB,GAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAzB;AA2CP,OAAO,MAAM0B,qBAAqB,GAAIC,IAAD,KAAW;AAC9CC,EAAAA,IAAI,EAAE;AACJC,IAAAA,OAAO,EAAE;AAAEC,MAAAA,OAAO,EAAE;AAAEC,QAAAA,EAAE,EAAEJ,IAAI,CAACE,OAAL,CAAaE;AAAnB;AAAX,KADL;AAEJC,IAAAA,KAAK,EAAEL,IAAI,CAACK,KAFR;AAGJC,IAAAA,QAAQ,EAAEN,IAAI,CAACM;AAHX;AADwC,CAAX,CAA9B;AAOP,OAAO,MAAMC,sBAAsB,GAAG,CAACC,SAAS,GAAG,EAAb,KACpCA,SADoC,aACpCA,SADoC,uBACpCA,SAAS,CAAEC,GAAX,CAAgBT,IAAD,IAAUD,qBAAqB,CAACC,IAAD,CAA9C,CADK;AAGP,OAAO,MAAMU,KAAK,GAAG,OAAO;AAC1BC,EAAAA,gBAD0B;AAE1BC,EAAAA,WAF0B;AAG1BC,EAAAA,QAH0B;AAI1BC,EAAAA,KAJ0B;AAK1BC,EAAAA,QAL0B;AAM1BC,EAAAA,GAN0B;AAO1BC,EAAAA;AAP0B,CAAP,KAQf;AACJ;AACA,QAAM;AAAEhB,IAAAA,IAAI,EAAEiB,OAAR;AAAiBC,IAAAA;AAAjB,MAA2B,MAAMR,gBAAgB,CAAC;AACtDS,IAAAA,SAAS,EAAE;AACTnB,MAAAA,IAAI,EAAEY;AADG;AAD2C,GAAD,CAAvD;AAKAQ,EAAAA,OAAO,CAACC,GAAR,CAAYJ,OAAZ,EAPI,CAQJ;;AACA,MAAIA,OAAO,CAACP,gBAAZ,EAA8B;AAC5B,QAAIS,SAAS,GAAG;AACdG,MAAAA,KAAK,EAAEL,OAAO,CAACP,gBAAR,CAAyBF,GAAzB,CAA8Be,CAAD,KAAQ;AAC1CpB,QAAAA,EAAE,EAAEoB,CAAC,CAACpB;AADoC,OAAR,CAA7B,CADO;AAIdW,MAAAA,QAAQ,EAAE;AAAEX,QAAAA,EAAE,EAAEW,QAAQ,CAACX;AAAf,OAJI;AAKdqB,MAAAA,QAAQ,EAAE;AAAErB,QAAAA,EAAE,EAAEU,KAAK,CAACY,MAAN,CAAatB;AAAnB,OALI;AAMduB,MAAAA,KAAK,EAAEX;AANO,KAAhB;;AAQA,QAAI;AAAA;;AACF,YAAM;AAAEf,QAAAA,IAAI,EAAE2B,eAAR;AAAyBC,QAAAA,MAAM,EAAEC;AAAjC,UAAwC,MAAMlB,WAAW,CAAC;AAC9DQ,QAAAA;AAD8D,OAAD,CAA/D;AAGAC,MAAAA,OAAO,CAACC,GAAR,CAAYM,eAAZ;AAEAlD,MAAAA,WAAW,CAAC,IAAD,CAAX;AACAC,MAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAH,MAAAA,SAAS;AACTyC,MAAAA,MAAM,CAACc,IAAP,CAAY;AACVC,QAAAA,QAAQ,EAAE,QADA;AAEVC,QAAAA,KAAK,EAAE;AAAEC,UAAAA,aAAa,EAAEN,eAAF,aAAEA,eAAF,gDAAEA,eAAe,CAAEhB,WAAnB,0DAAE,sBAA8BR;AAA/C;AAFG,OAAZ;AAID,KAbD,CAaE,MAAM,CAAE;AACX;AACF,CAzCM;AA0CP,OAAO,SAAS+B,IAAT,GAAgB;AACrB,QAAMrB,KAAK,GAAG1B,UAAU,CAACO,aAAD,CAAxB;AAEA,QAAMsB,MAAM,GAAGlC,SAAS,EAAxB,CAHqB,CAIrB;;AACA,QAAM;AAAEkB,IAAAA,IAAI,EAAEmC,QAAR;AAAkBC,IAAAA,OAAlB;AAA2BlB,IAAAA;AAA3B,MAAqC7C,QAAQ,CAACsB,IAAD,CAAnD,CALqB,CAMrB;;AACA,QAAM,CAACe,gBAAD,IAAqBpC,WAAW,CAACsB,kBAAD,CAAtC;AACA,QAAM,CAACe,WAAD,IAAgBrC,WAAW,CAACuB,YAAD,CAAjC;AAEA,MAAIuC,OAAO,IAAIlB,KAAX,IAAoB,CAACiB,QAAzB,EAAmC,OAAO,MAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAP;AAEnC,QAAM;AAAErB,IAAAA,QAAF;AAAYP,IAAAA,SAAZ;AAAuB8B,IAAAA;AAAvB,MAAgCF,QAAtC;AACA,MAAIpB,GAAG,GAAG,CAAV;AACAR,EAAAA,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEC,GAAX,CAAgB8B,QAAD,IAAc;AAC3BvB,IAAAA,GAAG,IAAIuB,QAAQ,CAAClC,KAAhB;AACD,GAFD,EAdqB,CAkBrB;;AACA,MAAIQ,QAAQ,GAAGN,sBAAsB,CAACC,SAAD,CAArC;AACAK,EAAAA,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEJ,GAAV,CACGR,IAAD,IAAWA,IAAI,CAACA,IAAL,CAAUwB,QAAV,GAAqB;AAAEtB,IAAAA,OAAO,EAAE;AAAEC,MAAAA,EAAE,EAAEU,KAAK,CAACY,MAAN,CAAatB;AAAnB;AAAX,GADlC,EApBqB,CAwBrB;;AAEA,SACE,MAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAEG,CAAAkC,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAElC,EAAN,IACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,QAAD;AAAU,IAAA,QAAQ,EAAEW,QAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADD,GAKC;AACE,IAAA,KAAK,EAAE;AACLyB,MAAAA,aAAa,EAAE1B,KAAK,CAAC2B,OAAN,CAAc,CAAd;AADV,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKE,MAAC,IAAD;AACE,IAAA,IAAI,EAAE;AAAET,MAAAA,QAAQ,EAAE,SAAZ;AAAuBC,MAAAA,KAAK,EAAE;AAAES,QAAAA,QAAQ,EAAE;AAAZ;AAA9B,KADR;AAEE,IAAA,KAAK,EAAE;AAAEC,MAAAA,YAAY,EAAE7B,KAAK,CAAC2B,OAAN,CAAc,CAAd,CAAhB;AAAkCG,MAAAA,OAAO,EAAE;AAA3C,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kEALF,EAWE,MAAC,SAAD;AAAW,IAAA,SAAS,EAAEpC,SAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXF,CAPJ,EAoBK,GApBL,EAsBE,MAAC,IAAD;AAAM,IAAA,SAAS,EAAEA,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAtBF,EAwBG,CAAAK,QAAQ,SAAR,IAAAA,QAAQ,WAAR,YAAAA,QAAQ,CAAEgC,MAAV,KAAoBP,IAApB,GACC;AACE,IAAA,KAAK,EAAExB,KAAK,CAACgC,GAAN,CAAUC,MADnB;AAEE,IAAA,OAAO,EAAE,MAAM;AACbrC,MAAAA,KAAK,CAAC;AACJC,QAAAA,gBADI;AAEJC,QAAAA,WAFI;AAGJC,QAAAA,QAHI;AAIJ7B,QAAAA,IAJI;AAKJ+B,QAAAA,QALI;AAMJC,QAAAA,GANI;AAOJC,QAAAA;AAPI,OAAD,CAAL;AASD,KAZH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CADD,GAiBG,IAzCN,CADF,CADF;AA+CD","sourcesContent":["import { gql, useQuery, useMutation } from \"@apollo/client\";\n\nimport { emptyCart } from \"../../apollo/action\";\nimport {\n  customerVar,\n  newOrderVar,\n  newOrderCountVar,\n} from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\n\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment, useContext } from \"react\";\n\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nimport { QuickCart } from \"./quickCart\";\nimport { Row, Col } from \"reactstrap\";\nimport { SellerContext } from \"../src/SellerProvider\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    user @client\n    customer @client\n  }\n`;\n// create orderItem\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`;\n\n// create Order\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nexport const OrderItemsCreateInput = (item) => ({\n  data: {\n    product: { connect: { id: item.product.id } },\n    price: item.price,\n    quantity: item.quantity,\n  },\n});\nexport const OrderItemsCreateInputs = (cartItems = []) =>\n  cartItems?.map((item) => OrderItemsCreateInput(item));\n\nexport const order = async ({\n  createOrderItems,\n  createOrder,\n  dataOICI,\n  theme,\n  customer,\n  sum,\n  router,\n}) => {\n  // create cart items\n  const { data: dataCOI, error } = await createOrderItems({\n    variables: {\n      data: dataOICI,\n    },\n  });\n  console.log(dataCOI);\n  // creat cart and connect cart items\n  if (dataCOI.createOrderItems) {\n    let variables = {\n      items: dataCOI.createOrderItems.map((e) => ({\n        id: e.id,\n      })),\n      customer: { id: customer.id },\n      ofSeller: { id: theme.seller.id },\n      total: sum,\n    };\n    try {\n      const { data: dataCreateOrder, errors: ER } = await createOrder({\n        variables,\n      });\n      console.log(dataCreateOrder);\n\n      newOrderVar(true);\n      newOrderCountVar(true);\n      emptyCart();\n      router.push({\n        pathname: \"/order\",\n        query: { createOrderId: dataCreateOrder?.createOrder?.id },\n      });\n    } catch {}\n  }\n};\nexport function Cart() {\n  const theme = useContext(SellerContext);\n\n  const router = useRouter();\n  // query\n  const { data: cartData, loading, error } = useQuery(CART);\n  // mutation\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n\n  if (loading || error || !cartData) return <Loading />;\n\n  const { customer, cartItems, user } = cartData;\n  let sum = 0;\n  cartItems?.map((cartItem) => {\n    sum += cartItem.price;\n  });\n\n  // create OrderItemsCreateInputs (GraphQL type)\n  let dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI?.map(\n    (data) => (data.data.ofSeller = { connect: { id: theme.seller.id } })\n  );\n\n  // function\n\n  return (\n    <Row>\n      <Col>\n        {/* CUSTOMER */}\n        {user?.id ? (\n          <div>\n            <Customer customer={customer} />\n          </div>\n        ) : (\n          <div\n            style={{\n              paddingBottom: theme.spacing(3),\n            }}\n          >\n            <Link\n              href={{ pathname: \"/signin\", query: { redirect: \"/cart\" } }}\n              style={{ marginBottom: theme.spacing(4), display: \"block\" }}\n            >\n              Mua hàng với tài khoản (Khuyên dùng)\n            </Link>\n            <QuickCart cartItems={cartItems} />\n          </div>\n        )}{\" \"}\n        {/* LIST CART ITEM */}\n        <List cartItems={cartItems} />\n        {/* CREATE BUTTON */}\n        {dataOICI?.length && user ? (\n          <button\n            style={theme.css.button}\n            onClick={() => {\n              order({\n                createOrderItems,\n                createOrder,\n                dataOICI,\n                page,\n                customer,\n                sum,\n                router,\n              });\n            }}\n          >\n            Xác nhận đơn hàng\n          </button>\n        ) : null}\n      </Col>\n    </Row>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}