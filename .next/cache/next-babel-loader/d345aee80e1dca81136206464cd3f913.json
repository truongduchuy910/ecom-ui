{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/home/huy/apps/ecom-ui/components/Cart/index.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation(\\n    $items: [OrderItemWhereUniqueInput]\\n    $customer: CustomerWhereUniqueInput\\n    $ofSeller: UserWhereUniqueInput\\n    $total: Int\\n  ) {\\n    createOrder(\\n      data: {\\n        customer: { connect: $customer }\\n        items: { connect: $items }\\n        ofSeller: { connect: $ofSeller }\\n        total: $total\\n      }\\n    ) {\\n      id\\n      seller {\\n        id\\n        name\\n      }\\n      items {\\n        id\\n        product {\\n          image {\\n            publicUrl\\n          }\\n          images {\\n            file {\\n              publicUrl\\n            }\\n          }\\n          name\\n        }\\n        price\\n        quantity\\n        attributes {\\n          id\\n          name\\n        }\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation($data: [OrderItemsCreateInput]) {\\n    createOrderItems(data: $data) {\\n      id\\n    }\\n  }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  query {\\n    cartItems @client\\n    user @client\\n    customer @client\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { gql, useQuery, useMutation } from \"@apollo/client\";\nimport { emptyCart } from \"../../apollo/action\";\nimport { customerVar, newOrderVar, newOrderCountVar } from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport { theme } from \"../../config/index\";\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nimport { QuickCart } from \"./quickCart\";\nexport var CART = gql(_templateObject()); // create orderItem\n\nexport var CREATE_ORDER_ITEMS = gql(_templateObject2()); // create Order\n\nexport var CREATE_ORDER = gql(_templateObject3());\nexport var OrderItemsCreateInput = function OrderItemsCreateInput(item) {\n  return {\n    data: {\n      product: {\n        connect: {\n          id: item.product.id\n        }\n      },\n      price: item.price,\n      quantity: item.quantity\n    }\n  };\n};\n_c = OrderItemsCreateInput;\nexport var OrderItemsCreateInputs = function OrderItemsCreateInputs() {\n  var cartItems = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return cartItems === null || cartItems === void 0 ? void 0 : cartItems.map(function (item) {\n    return OrderItemsCreateInput(item);\n  });\n};\n_c2 = OrderItemsCreateInputs;\nexport var order = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var createOrderItems, createOrder, dataOICI, page, customer, sum, router, _yield$createOrderIte, dataCOI, error, variables, _dataCreateOrder$crea, _yield$createOrder, dataCreateOrder, ER;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            createOrderItems = _ref.createOrderItems, createOrder = _ref.createOrder, dataOICI = _ref.dataOICI, page = _ref.page, customer = _ref.customer, sum = _ref.sum, router = _ref.router;\n            _context.next = 3;\n            return createOrderItems({\n              variables: {\n                data: dataOICI\n              }\n            });\n\n          case 3:\n            _yield$createOrderIte = _context.sent;\n            dataCOI = _yield$createOrderIte.data;\n            error = _yield$createOrderIte.error;\n            console.log(dataCOI); // creat cart and connect cart items\n\n            if (!dataCOI.createOrderItems) {\n              _context.next = 24;\n              break;\n            }\n\n            variables = {\n              items: dataCOI.createOrderItems.map(function (e) {\n                return {\n                  id: e.id\n                };\n              }),\n              customer: {\n                id: customer.id\n              },\n              ofSeller: {\n                id: page.seller.id\n              },\n              total: sum\n            };\n            _context.prev = 9;\n            _context.next = 12;\n            return createOrder({\n              variables: variables\n            });\n\n          case 12:\n            _yield$createOrder = _context.sent;\n            dataCreateOrder = _yield$createOrder.data;\n            ER = _yield$createOrder.errors;\n            console.log(dataCreateOrder);\n            newOrderVar(true);\n            newOrderCountVar(true);\n            emptyCart();\n            router.push({\n              pathname: \"/order\",\n              query: {\n                createOrderId: dataCreateOrder === null || dataCreateOrder === void 0 ? void 0 : (_dataCreateOrder$crea = dataCreateOrder.createOrder) === null || _dataCreateOrder$crea === void 0 ? void 0 : _dataCreateOrder$crea.id\n              }\n            });\n            _context.next = 24;\n            break;\n\n          case 22:\n            _context.prev = 22;\n            _context.t0 = _context[\"catch\"](9);\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[9, 22]]);\n  }));\n\n  return function order(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport function Cart() {\n  _s();\n\n  var router = useRouter(); // query\n\n  var _useQuery = useQuery(CART),\n      cartData = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error; // mutation\n\n\n  var _useMutation = useMutation(CREATE_ORDER_ITEMS),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createOrderItems = _useMutation2[0];\n\n  var _useMutation3 = useMutation(CREATE_ORDER),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      createOrder = _useMutation4[0];\n\n  if (loading || error || !cartData) return __jsx(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 45\n    }\n  });\n  var customer = cartData.customer,\n      cartItems = cartData.cartItems,\n      user = cartData.user;\n  var sum = 0;\n  cartItems === null || cartItems === void 0 ? void 0 : cartItems.map(function (cartItem) {\n    sum += cartItem.price;\n  }); // create OrderItemsCreateInputs (GraphQL type)\n\n  var dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.map(function (data) {\n    return data.data.ofSeller = {\n      connect: {\n        id: page.seller.id\n      }\n    };\n  }); // function\n\n  return __jsx(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 5\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }\n  }, (user === null || user === void 0 ? void 0 : user.id) ? __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 11\n    }\n  }, __jsx(Customer, {\n    customer: customer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 13\n    }\n  })) : __jsx(\"div\", {\n    style: {\n      paddingBottom: theme.spacing(3)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: \"/signin\",\n      query: {\n        redirect: \"/cart\"\n      }\n    },\n    style: {\n      marginBottom: theme.spacing(4),\n      display: \"block\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }\n  }, \"Mua h\\xE0ng v\\u1EDBi t\\xE0i kho\\u1EA3n (Khuy\\xEAn d\\xF9ng)\"), __jsx(QuickCart, {\n    cartItems: cartItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }\n  }, __jsx(List, {\n    cartItems: cartItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 9\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }\n  }, (dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.length) && user ? __jsx(\"button\", {\n    style: css.button,\n    onClick: function onClick() {\n      order({\n        createOrderItems: createOrderItems,\n        createOrder: createOrder,\n        dataOICI: dataOICI,\n        page: page,\n        customer: customer,\n        sum: sum,\n        router: router\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 11\n    }\n  }, \"X\\xE1c nh\\u1EADn \\u0111\\u01A1n h\\xE0ng\") : null));\n}\n\n_s(Cart, \"mlgFtjbWCv6kmZSWtKlWWdBFJGk=\", false, function () {\n  return [useRouter, useQuery, useMutation, useMutation];\n});\n\n_c3 = Cart;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"OrderItemsCreateInput\");\n$RefreshReg$(_c2, \"OrderItemsCreateInputs\");\n$RefreshReg$(_c3, \"Cart\");","map":{"version":3,"sources":["/home/huy/apps/ecom-ui/components/Cart/index.js"],"names":["gql","useQuery","useMutation","emptyCart","customerVar","newOrderVar","newOrderCountVar","Item","CartItem","List","useRouter","page","formatMoney","getErrorMessage","Fragment","css","theme","Loading","Link","Customer","QuickCart","CART","CREATE_ORDER_ITEMS","CREATE_ORDER","OrderItemsCreateInput","item","data","product","connect","id","price","quantity","OrderItemsCreateInputs","cartItems","map","order","createOrderItems","createOrder","dataOICI","customer","sum","router","variables","dataCOI","error","console","log","items","e","ofSeller","seller","total","dataCreateOrder","ER","errors","push","pathname","query","createOrderId","Cart","cartData","loading","user","cartItem","paddingBottom","spacing","redirect","marginBottom","display","length","button"],"mappings":"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","sourcesContent":["import { gql, useQuery, useMutation } from \"@apollo/client\";\n\nimport { emptyCart } from \"../../apollo/action\";\nimport {\n  customerVar,\n  newOrderVar,\n  newOrderCountVar,\n} from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\n\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport { theme } from \"../../config/index\";\n\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nimport { QuickCart } from \"./quickCart\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    user @client\n    customer @client\n  }\n`;\n// create orderItem\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`;\n\n// create Order\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nexport const OrderItemsCreateInput = (item) => ({\n  data: {\n    product: { connect: { id: item.product.id } },\n    price: item.price,\n    quantity: item.quantity,\n  },\n});\nexport const OrderItemsCreateInputs = (cartItems = []) =>\n  cartItems?.map((item) => OrderItemsCreateInput(item));\n\nexport const order = async ({\n  createOrderItems,\n  createOrder,\n  dataOICI,\n  page,\n  customer,\n  sum,\n  router,\n}) => {\n  // create cart items\n  const { data: dataCOI, error } = await createOrderItems({\n    variables: {\n      data: dataOICI,\n    },\n  });\n  console.log(dataCOI);\n  // creat cart and connect cart items\n  if (dataCOI.createOrderItems) {\n    let variables = {\n      items: dataCOI.createOrderItems.map((e) => ({\n        id: e.id,\n      })),\n      customer: { id: customer.id },\n      ofSeller: { id: page.seller.id },\n      total: sum,\n    };\n    try {\n      const { data: dataCreateOrder, errors: ER } = await createOrder({\n        variables,\n      });\n      console.log(dataCreateOrder);\n\n      newOrderVar(true);\n      newOrderCountVar(true);\n      emptyCart();\n      router.push({\n        pathname: \"/order\",\n        query: { createOrderId: dataCreateOrder?.createOrder?.id },\n      });\n    } catch {}\n  }\n};\nexport function Cart() {\n  const router = useRouter();\n  // query\n  const { data: cartData, loading, error } = useQuery(CART);\n  // mutation\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n\n  if (loading || error || !cartData) return <Loading />;\n\n  const { customer, cartItems, user } = cartData;\n  let sum = 0;\n  cartItems?.map((cartItem) => {\n    sum += cartItem.price;\n  });\n\n  // create OrderItemsCreateInputs (GraphQL type)\n  let dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI?.map(\n    (data) => (data.data.ofSeller = { connect: { id: page.seller.id } })\n  );\n\n  // function\n\n  return (\n    <Row>\n      <Col>\n        {/* CUSTOMER */}\n        {user?.id ? (\n          <div>\n            <Customer customer={customer} />\n          </div>\n        ) : (\n          <div\n            style={{\n              paddingBottom: theme.spacing(3),\n            }}\n          >\n            <Link\n              href={{ pathname: \"/signin\", query: { redirect: \"/cart\" } }}\n              style={{ marginBottom: theme.spacing(4), display: \"block\" }}\n            >\n              Mua hàng với tài khoản (Khuyên dùng)\n            </Link>\n            <QuickCart cartItems={cartItems} />\n          </div>\n        )}\n      </Col>\n      <Col>\n        {/* LIST CART ITEM */}\n        <List cartItems={cartItems} />\n      </Col>\n      <Col>\n        {/* CREATE BUTTON */}\n        {dataOICI?.length && user ? (\n          <button\n            style={css.button}\n            onClick={() => {\n              order({\n                createOrderItems,\n                createOrder,\n                dataOICI,\n                page,\n                customer,\n                sum,\n                router,\n              });\n            }}\n          >\n            Xác nhận đơn hàng\n          </button>\n        ) : null}\n      </Col>\n    </Row>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}