{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/home/huy/apps/ecom-ui/components/Cart/index.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation(\\n    $items: [OrderItemWhereUniqueInput]\\n    $customer: CustomerWhereUniqueInput\\n    $ofSeller: UserWhereUniqueInput\\n    $total: Int\\n  ) {\\n    createOrder(\\n      data: {\\n        customer: { connect: $customer }\\n        items: { connect: $items }\\n        ofSeller: { connect: $ofSeller }\\n        total: $total\\n      }\\n    ) {\\n      id\\n      seller {\\n        id\\n        name\\n      }\\n      items {\\n        id\\n        product {\\n          image {\\n            publicUrl\\n          }\\n          images {\\n            file {\\n              publicUrl\\n            }\\n          }\\n          name\\n        }\\n        price\\n        quantity\\n        attributes {\\n          id\\n          name\\n        }\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation($data: [OrderItemsCreateInput]) {\\n    createOrderItems(data: $data) {\\n      id\\n    }\\n  }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  query {\\n    cartItems @client\\n    user @client\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { gql, useQuery, useMutation } from \"@apollo/client\";\nimport { emptyCart } from \"../../apollo/action\";\nimport { customerVar, newOrderVar, newOrderCountVar } from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nexport var CART = gql(_templateObject()); // create orderItem\n\nexport var CREATE_ORDER_ITEMS = gql(_templateObject2()); // create Order\n\nexport var CREATE_ORDER = gql(_templateObject3());\n\nvar OrderItemsCreateInput = function OrderItemsCreateInput(item) {\n  return {\n    data: {\n      product: {\n        connect: {\n          id: item.product.id\n        }\n      },\n      price: item.price,\n      quantity: item.quantity\n    }\n  };\n};\n\n_c = OrderItemsCreateInput;\n\nvar OrderItemsCreateInputs = function OrderItemsCreateInputs() {\n  var cartItems = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return cartItems.map(function (item) {\n    return OrderItemsCreateInput(item);\n  });\n};\n\n_c2 = OrderItemsCreateInputs;\nexport function Cart() {\n  _s();\n\n  var router = useRouter(); // loading data\n\n  var _useQuery = useQuery(CART),\n      cartData = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error;\n\n  if (loading || error || !cartData) return null;\n  var customer = cartData.customer,\n      cartItems = cartData.cartItems,\n      isLogin = cartData.user;\n  var sum = 0;\n  cartItems === null || cartItems === void 0 ? void 0 : cartItems.map(function (cartItem) {\n    sum += cartItem.price;\n  }); // mutation\n\n  var _useMutation = useMutation(CREATE_ORDER_ITEMS),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createOrderItems = _useMutation2[0];\n\n  var _useMutation3 = useMutation(CREATE_ORDER),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      createOrder = _useMutation4[0]; // create OrderItemsCreateInputs (GraphQL type)\n\n\n  var dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI.map(function (data) {\n    return data.data.ofSeller = {\n      connect: {\n        id: page.seller.id\n      }\n    };\n  }); // function\n\n  var order = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$createOrderIte, dataCOI, error, variables, _yield$createOrder, dataCreateOrder, ER;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return createOrderItems({\n                variables: {\n                  data: dataOICI\n                }\n              });\n\n            case 2:\n              _yield$createOrderIte = _context.sent;\n              dataCOI = _yield$createOrderIte.data;\n              error = _yield$createOrderIte.error;\n\n              if (!dataCOI.createOrderItems) {\n                _context.next = 21;\n                break;\n              }\n\n              variables = {\n                items: dataCOI.createOrderItems.map(function (e) {\n                  return {\n                    id: e.id\n                  };\n                }),\n                customer: {\n                  id: customer.id\n                },\n                ofSeller: {\n                  id: page.seller.id\n                },\n                total: sum\n              };\n              _context.prev = 7;\n              _context.next = 10;\n              return createOrder({\n                variables: variables\n              });\n\n            case 10:\n              _yield$createOrder = _context.sent;\n              dataCreateOrder = _yield$createOrder.data;\n              ER = _yield$createOrder.errors;\n              newOrderVar(true);\n              newOrderCountVar(true);\n              emptyCart();\n              router.push({\n                pathname: \"/order\"\n              });\n              _context.next = 21;\n              break;\n\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](7);\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 19]]);\n    }));\n\n    return function order() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return isLogin ? __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 5\n    }\n  }, __jsx(Customer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }\n  }), __jsx(List, {\n    cartItems: cartItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 7\n    }\n  }), (dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.length) && isLogin ? __jsx(\"button\", {\n    style: css.button,\n    onClick: order,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }, \"X\\xE1c nh\\u1EADn \\u0111\\u01A1n h\\xE0ng\") : null) : __jsx(\"div\", {\n    style: {\n      marginBottom: theme.spacing(4)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 5\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: \"/signin\",\n      query: {\n        redirect: \"/cart\"\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }\n  }, \"B\\u1EA5m v\\xE0o \\u0111\\xE2y \\u0111\\u1EC3 \\u0111\\u0103ng nh\\u1EADp v\\xE0 ti\\u1EBFp t\\u1EE5c\"));\n}\n\n_s(Cart, \"mlgFtjbWCv6kmZSWtKlWWdBFJGk=\", false, function () {\n  return [useRouter, useQuery, useMutation, useMutation];\n});\n\n_c3 = Cart;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"OrderItemsCreateInput\");\n$RefreshReg$(_c2, \"OrderItemsCreateInputs\");\n$RefreshReg$(_c3, \"Cart\");","map":{"version":3,"sources":["/home/huy/apps/ecom-ui/components/Cart/index.js"],"names":["gql","useQuery","useMutation","emptyCart","customerVar","newOrderVar","newOrderCountVar","Item","CartItem","List","useRouter","page","formatMoney","getErrorMessage","Fragment","css","theme","Loading","Link","Customer","CART","CREATE_ORDER_ITEMS","CREATE_ORDER","OrderItemsCreateInput","item","data","product","connect","id","price","quantity","OrderItemsCreateInputs","cartItems","map","Cart","router","cartData","loading","error","customer","isLogin","user","sum","cartItem","createOrderItems","createOrder","dataOICI","ofSeller","seller","order","variables","dataCOI","items","e","total","dataCreateOrder","ER","errors","push","pathname","length","button","marginBottom","spacing","query","redirect"],"mappings":"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","sourcesContent":["import { gql, useQuery, useMutation } from \"@apollo/client\";\n\nimport { emptyCart } from \"../../apollo/action\";\nimport {\n  customerVar,\n  newOrderVar,\n  newOrderCountVar,\n} from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { List } from \"./list\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\n\nimport { formatMoney, getErrorMessage } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nimport { Loading } from \"../src/Loading\";\nimport { Link } from \"../src/Link\";\nimport { List as Customer } from \"../Customer/CurrentCustomer\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    user @client\n  }\n`;\n// create orderItem\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`;\n\n// create Order\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nconst OrderItemsCreateInput = (item) => ({\n  data: {\n    product: { connect: { id: item.product.id } },\n    price: item.price,\n    quantity: item.quantity,\n  },\n});\nconst OrderItemsCreateInputs = (cartItems = []) =>\n  cartItems.map((item) => OrderItemsCreateInput(item));\n\nexport function Cart() {\n  const router = useRouter();\n\n  // loading data\n  const { data: cartData, loading, error } = useQuery(CART);\n  if (loading || error || !cartData) return null;\n\n  const { customer, cartItems, user: isLogin } = cartData;\n  let sum = 0;\n  cartItems?.map((cartItem) => {\n    sum += cartItem.price;\n  });\n\n  // mutation\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n  // create OrderItemsCreateInputs (GraphQL type)\n  let dataOICI = OrderItemsCreateInputs(cartItems);\n  dataOICI.map(\n    (data) => (data.data.ofSeller = { connect: { id: page.seller.id } })\n  );\n\n  // function\n  const order = async () => {\n    // create cart items\n    const { data: dataCOI, error } = await createOrderItems({\n      variables: {\n        data: dataOICI,\n      },\n    });\n    // creat cart and connect cart items\n    if (dataCOI.createOrderItems) {\n      let variables = {\n        items: dataCOI.createOrderItems.map((e) => ({\n          id: e.id,\n        })),\n        customer: { id: customer.id },\n        ofSeller: { id: page.seller.id },\n        total: sum,\n      };\n      try {\n        const { data: dataCreateOrder, errors: ER } = await createOrder({\n          variables,\n        });\n        newOrderVar(true);\n        newOrderCountVar(true);\n        emptyCart();\n        router.push({ pathname: \"/order\" });\n      } catch {}\n    }\n  };\n\n  return isLogin ? (\n    <div>\n      <Customer />\n      <List cartItems={cartItems} />\n      {dataOICI?.length && isLogin ? (\n        <button style={css.button} onClick={order}>\n          Xác nhận đơn hàng\n        </button>\n      ) : null}\n    </div>\n  ) : (\n    <div style={{ marginBottom: theme.spacing(4) }}>\n      <Link href={{ pathname: \"/signin\", query: { redirect: \"/cart\" } }}>\n        Bấm vào đây để đăng nhập và tiếp tục\n      </Link>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}