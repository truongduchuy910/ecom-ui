{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _jsxFileName = \"/home/huy/apps/ecom-ui/components/Cart/list.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation(\\n    $items: [OrderItemWhereUniqueInput]\\n    $customer: CustomerWhereUniqueInput\\n    $ofSeller: UserWhereUniqueInput\\n    $total: Int\\n  ) {\\n    createOrder(\\n      data: {\\n        customer: { connect: $customer }\\n        items: { connect: $items }\\n        ofSeller: { connect: $ofSeller }\\n        total: $total\\n      }\\n    ) {\\n      id\\n      seller {\\n        id\\n        name\\n      }\\n      items {\\n        id\\n        product {\\n          image {\\n            publicUrl\\n          }\\n          images {\\n            file {\\n              publicUrl\\n            }\\n          }\\n          name\\n        }\\n        price\\n        quantity\\n        attributes {\\n          id\\n          name\\n        }\\n      }\\n    }\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  mutation($data: [OrderItemsCreateInput]) {\\n    createOrderItems(data: $data) {\\n      id\\n    }\\n  }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  query {\\n    cartItems @client\\n    customer @client\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { gql, useQuery, useMutation } from \"@apollo/client\";\nimport { emptyCart } from \"../../apollo/action\";\nimport { customerVar, newOrderVar, newOrderCountVar } from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\nimport { formatMoney } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nimport { Loading } from \"../src/Loading\";\nexport var CART = gql(_templateObject()); // create orderItem\n\nexport var CREATE_ORDER_ITEMS = gql(_templateObject2()); // create Order\n\nexport var CREATE_ORDER = gql(_templateObject3());\n\nvar OrderItemsCreateInput = function OrderItemsCreateInput(item) {\n  return {\n    data: {\n      product: {\n        connect: {\n          id: item.product.id\n        }\n      },\n      price: item.price,\n      quantity: item.quantity\n    }\n  };\n};\n\n_c = OrderItemsCreateInput;\n\nvar OrderItemsCreateInputs = function OrderItemsCreateInputs(cartItems) {\n  return cartItems.map(function (item) {\n    return OrderItemsCreateInput(item);\n  });\n};\n\n_c2 = OrderItemsCreateInputs;\nexport function List() {\n  _s();\n\n  var _dataCartItems$cartIt,\n      _dataCartItems$cartIt2,\n      _dataCartItems$cartIt3,\n      _this = this;\n\n  var _useQuery = useQuery(CART),\n      dataCartItems = _useQuery.data,\n      loading = _useQuery.loading,\n      error = _useQuery.error;\n\n  if (loading) return __jsx(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 23\n    }\n  });\n\n  var _useMutation = useMutation(CREATE_ORDER_ITEMS),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createOrderItems = _useMutation2[0];\n\n  var _useMutation3 = useMutation(CREATE_ORDER),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      createOrder = _useMutation4[0];\n\n  var router = useRouter();\n  var customer = dataCartItems === null || dataCartItems === void 0 ? void 0 : dataCartItems.customer;\n\n  var order = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var dataOICI, _yield$createOrderIte, dataCreateOrderItems, _error, variables, _yield$createOrder, dataCreateOrder, ER;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              e.stopPropagation();\n              dataOICI = OrderItemsCreateInputs(dataCartItems === null || dataCartItems === void 0 ? void 0 : dataCartItems.cartItems);\n\n              if (!((dataOICI === null || dataOICI === void 0 ? void 0 : dataOICI.length) && (customer === null || customer === void 0 ? void 0 : customer.id))) {\n                _context.next = 27;\n                break;\n              }\n\n              dataOICI.map(function (data) {\n                return data.data.ofSeller = {\n                  connect: {\n                    id: page.seller.id\n                  }\n                };\n              });\n              _context.next = 7;\n              return createOrderItems({\n                variables: {\n                  data: dataOICI\n                }\n              });\n\n            case 7:\n              _yield$createOrderIte = _context.sent;\n              dataCreateOrderItems = _yield$createOrderIte.data;\n              _error = _yield$createOrderIte.error;\n\n              if (!dataCreateOrderItems.createOrderItems) {\n                _context.next = 27;\n                break;\n              }\n\n              variables = {\n                items: dataCreateOrderItems.createOrderItems.map(function (e) {\n                  return {\n                    id: e.id\n                  };\n                }),\n                customer: {\n                  id: customer.id\n                },\n                ofSeller: {\n                  id: page.seller.id\n                },\n                total: sum\n              };\n              _context.prev = 12;\n              _context.next = 15;\n              return createOrder({\n                variables: variables\n              });\n\n            case 15:\n              _yield$createOrder = _context.sent;\n              dataCreateOrder = _yield$createOrder.data;\n              ER = _yield$createOrder.errors;\n              newOrderVar(true);\n              newOrderCountVar(true);\n              emptyCart();\n              router.push({\n                pathname: \"/order\"\n              });\n              _context.next = 27;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t0 = _context[\"catch\"](12);\n              console.log(_context.t0);\n\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[12, 24]]);\n    }));\n\n    return function order(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var sum = 0;\n  dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt = dataCartItems.cartItems) === null || _dataCartItems$cartIt === void 0 ? void 0 : _dataCartItems$cartIt.map(function (cartItem) {\n    sum += cartItem.price;\n  });\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, __jsx(\"h5\", {\n    style: css.h5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }, \"Th\\xF4ng Tin Ng\\u01B0\\u1EDDi Nh\\u1EADn\"), __jsx(\"div\", {\n    style: {\n      marginBottom: theme.spacing(3)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }\n  }, (customer === null || customer === void 0 ? void 0 : customer.id) ? __jsx(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 11\n    }\n  }, __jsx(\"a\", {\n    style: css.a,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, customer.name), __jsx(\"a\", {\n    style: css.a,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }\n  }, customer.phone), __jsx(\"a\", {\n    style: css.a,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }\n  }, customer.address)) : \"Bạn chưa chọn địa chỉ nhận.\"), __jsx(\"h5\", {\n    style: css.h5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }, \"T\\u1ED5ng\"), __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }, formatMoney(sum)), __jsx(\"button\", {\n    style: _objectSpread(_objectSpread({}, css.button), {}, {\n      marginBottom: theme.spacing(4)\n    }),\n    onClick: order,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }\n  }, \"\\u0110\\u1EB7t H\\xE0ng\"), dataCartItems ? (dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt2 = dataCartItems.cartItems) === null || _dataCartItems$cartIt2 === void 0 ? void 0 : _dataCartItems$cartIt2.length) === 0 ? __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 11\n    }\n  }, \"B\\u1EA1n ch\\u01B0a ch\\u1ECDn s\\u1EA3n ph\\u1EA9m n\\xE0o!\") : dataCartItems === null || dataCartItems === void 0 ? void 0 : (_dataCartItems$cartIt3 = dataCartItems.cartItems) === null || _dataCartItems$cartIt3 === void 0 ? void 0 : _dataCartItems$cartIt3.map(function (cartItem) {\n    return __jsx(CartItem, {\n      key: cartItem.product.id,\n      cartItem: cartItem,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 20\n      }\n    });\n  }) : null);\n}\n\n_s(List, \"VyVstGaoYTSt91X0I1ctacT5Kf4=\", false, function () {\n  return [useQuery, useMutation, useMutation, useRouter];\n});\n\n_c3 = List;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"OrderItemsCreateInput\");\n$RefreshReg$(_c2, \"OrderItemsCreateInputs\");\n$RefreshReg$(_c3, \"List\");","map":{"version":3,"sources":["/home/huy/apps/ecom-ui/components/Cart/list.js"],"names":["gql","useQuery","useMutation","emptyCart","customerVar","newOrderVar","newOrderCountVar","Item","CartItem","useRouter","page","formatMoney","Fragment","css","theme","Loading","CART","CREATE_ORDER_ITEMS","CREATE_ORDER","OrderItemsCreateInput","item","data","product","connect","id","price","quantity","OrderItemsCreateInputs","cartItems","map","List","dataCartItems","loading","error","createOrderItems","createOrder","router","customer","order","e","preventDefault","stopPropagation","dataOICI","length","ofSeller","seller","variables","dataCreateOrderItems","items","total","sum","dataCreateOrder","ER","errors","push","pathname","console","log","cartItem","h5","marginBottom","spacing","a","name","phone","address","button"],"mappings":"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","sourcesContent":["import { gql, useQuery, useMutation } from \"@apollo/client\";\n\nimport { emptyCart } from \"../../apollo/action\";\nimport {\n  customerVar,\n  newOrderVar,\n  newOrderCountVar,\n} from \"../../apollo/client\";\nimport { Item as CartItem } from \"./item\";\nimport { useRouter } from \"next/router\";\nimport { page } from \"../../config/index\";\n\nimport { formatMoney } from \"../../lib/chip\";\nimport { Fragment } from \"react\";\nimport { css } from \"../src/css\";\nimport theme from \"../src/theme\";\nimport { Loading } from \"../src/Loading\";\nexport const CART = gql`\n  query {\n    cartItems @client\n    customer @client\n  }\n`;\n// create orderItem\nexport const CREATE_ORDER_ITEMS = gql`\n  mutation($data: [OrderItemsCreateInput]) {\n    createOrderItems(data: $data) {\n      id\n    }\n  }\n`;\n\n// create Order\nexport const CREATE_ORDER = gql`\n  mutation(\n    $items: [OrderItemWhereUniqueInput]\n    $customer: CustomerWhereUniqueInput\n    $ofSeller: UserWhereUniqueInput\n    $total: Int\n  ) {\n    createOrder(\n      data: {\n        customer: { connect: $customer }\n        items: { connect: $items }\n        ofSeller: { connect: $ofSeller }\n        total: $total\n      }\n    ) {\n      id\n      seller {\n        id\n        name\n      }\n      items {\n        id\n        product {\n          image {\n            publicUrl\n          }\n          images {\n            file {\n              publicUrl\n            }\n          }\n          name\n        }\n        price\n        quantity\n        attributes {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\nconst OrderItemsCreateInput = (item) => ({\n  data: {\n    product: { connect: { id: item.product.id } },\n    price: item.price,\n    quantity: item.quantity,\n  },\n});\nconst OrderItemsCreateInputs = (cartItems) =>\n  cartItems.map((item) => OrderItemsCreateInput(item));\n\nexport function List() {\n  const { data: dataCartItems, loading, error } = useQuery(CART);\n  if (loading) return <Loading />;\n  const [createOrderItems] = useMutation(CREATE_ORDER_ITEMS);\n  const [createOrder] = useMutation(CREATE_ORDER);\n  const router = useRouter();\n  const customer = dataCartItems?.customer;\n  const order = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const dataOICI = OrderItemsCreateInputs(dataCartItems?.cartItems);\n\n    if (dataOICI?.length && customer?.id) {\n      dataOICI.map(\n        (data) => (data.data.ofSeller = { connect: { id: page.seller.id } })\n      );\n      const { data: dataCreateOrderItems, error } = await createOrderItems({\n        variables: {\n          data: dataOICI,\n        },\n      });\n\n      if (dataCreateOrderItems.createOrderItems) {\n        let variables = {\n          items: dataCreateOrderItems.createOrderItems.map((e) => ({\n            id: e.id,\n          })),\n          customer: { id: customer.id },\n          ofSeller: { id: page.seller.id },\n          total: sum,\n        };\n        try {\n          const { data: dataCreateOrder, errors: ER } = await createOrder({\n            variables,\n          });\n          newOrderVar(true);\n          newOrderCountVar(true);\n          emptyCart();\n          router.push({ pathname: \"/order\" });\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    }\n  };\n\n  let sum = 0;\n  dataCartItems?.cartItems?.map((cartItem) => {\n    sum += cartItem.price;\n  });\n  return (\n    <div>\n      <h5 style={css.h5}>Thông Tin Người Nhận</h5>\n      <div style={{ marginBottom: theme.spacing(3) }}>\n        {customer?.id ? (\n          <Fragment>\n            <a style={css.a}>{customer.name}</a>\n            <a style={css.a}>{customer.phone}</a>\n            <a style={css.a}>{customer.address}</a>\n          </Fragment>\n        ) : (\n          \"Bạn chưa chọn địa chỉ nhận.\"\n        )}\n      </div>\n      <h5 style={css.h5}>Tổng</h5>\n      <p>{formatMoney(sum)}</p>\n      <button\n        style={{ ...css.button, marginBottom: theme.spacing(4) }}\n        onClick={order}\n      >\n        Đặt Hàng\n      </button>\n      {dataCartItems ? (\n        dataCartItems?.cartItems?.length === 0 ? (\n          <p>Bạn chưa chọn sản phẩm nào!</p>\n        ) : (\n          dataCartItems?.cartItems?.map((cartItem) => {\n            return <CartItem key={cartItem.product.id} cartItem={cartItem} />;\n          })\n        )\n      ) : null}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}